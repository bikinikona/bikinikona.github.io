
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>25-26 指名馬一覧</title>
  <style>
    body { font-family: sans-serif; background-color: #f0f8ff; padding: 20px; }
    h2 { color: #003366; border-bottom: 2px solid #ccc; padding-bottom: 5px; margin-top: 40px; }
    table { border-collapse: collapse; width: auto; background-color: white; margin-bottom: 20px; table-layout: fixed; }
    th, td { border: 1px solid #aaa; padding: 6px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; font-size: 14px; }
    th { background-color: #d0e0f0; }
    td.left { text-align: left; }
    td.right { text-align: right; }
    a { text-decoration: none; color: inherit; }
    .horse-name a { font-weight: bold; font-size: 1.1em; }
    .point-badge { display: inline-block; background-color: #003366; color: white; font-size: 0.8em; padding: 3px 8px; margin-left: 10px; border-radius: 10px; }

    .fancy-table table { width: auto; border-collapse: collapse; margin: 20px 0; background-color: #fff; }
    .fancy-table th { background-color: #003366; color: white; padding: 8px; }
    .fancy-table td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    .fancy-table tr:nth-child(even) { background-color: #f2f6fa; }
    .fancy-table { max-width: 800px; margin-bottom: 40px; table-layout: auto; }
    .fancy-table td.left, .fancy-table th.left { text-align: left; }
    .fancy-table td.right, .fancy-table th.right { text-align: right; max-width: 60px; white-space: nowrap; }
    .fancy-table td.rank, .fancy-table th.rank { width: 40px; }
  </style>
</head>
<body>
  <h1>2025-2026 指名馬一覧</h1>
  <div id="table-container">読み込み中...</div>

  <hr style="margin: 40px 0; border: none; border-top: 3px solid #999;">
  <h2>成績</h2>
  <div id="summary-table" class="fancy-table">読み込み中...</div>

  <hr style="margin: 40px 0; border: none; border-top: 3px dashed #ccc;">
  <h2>馬ポイントランキング（上位20頭）</h2>
  <div id="ranking-table" class="fancy-table">読み込み中...</div>

  <script>
    async function loadAdditionalCSV(url, targetId, alignRule, titleRow = true, rowLimit = null, removeZeroPoint = false, sortColumnIndex = null) {
      const res = await fetch(url);
      const text = await res.text();
      const rows = text.trim().split("\n").map(r => r.split(","));
      const headers = titleRow ? rows[0] : [];
      let data = titleRow ? rows.slice(1) : rows;
      if (sortColumnIndex !== null) {
        data.sort((a, b) => {
          const valA = parseInt(a[sortColumnIndex].replace(/[^\d]/g, '')) || 0;
          const valB = parseInt(b[sortColumnIndex].replace(/[^\d]/g, '')) || 0;
          return valB - valA;
        });
      }
      let html = "<table class='fancy-table'><thead><tr><th class='rank'>順位</th>";
      headers.forEach(h => html += `<th>${h}</th>`);
      html += "</tr></thead><tbody>";
      let count = 0;
      for (const row of data) {
        const point = parseInt(row[headers.length - 1].replace(/[^\d]/g, '')) || 0;
        if (removeZeroPoint && point === 0) continue;
        html += `<tr><td class="right rank">${count + 1}</td>`;
        row.forEach((cell, idx) => {
          let alignClass = 'right';
          if (alignRule === 'summary') alignClass = (idx === 0) ? 'left' : 'right';
          else if (alignRule === 'ranking') alignClass = (idx === 0 || idx === 1) ? 'left' : 'right';
          if (targetId === 'ranking-table' && idx === 1) {
            const link = row[7] || "#";  // H列（index 7）をリンク先に
            html += `<td class="${alignClass}"><a href="${link}" target="_blank">${cell}</a></td>`;
          } else {
            html += `<td class="${alignClass}">${cell}</td>`;
          }
        });
        html += "</tr>";
        count++;
        if (rowLimit && count >= rowLimit) break;
      }
      html += "</tbody></table>";
      document.getElementById(targetId).innerHTML = html;
    }

    loadAdditionalCSV(
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vSaLvOcmHtlpogDiYQtvcGQD15vhTxms_YVyBK2nFs7JKBYhVVOqdyD8bEG9TfGaoB_ROitY7CnOP_h/pub?gid=168257426&single=true&output=csv',
      'summary-table',
      'summary',
      true,
      null,
      false,
      6
    );

    loadAdditionalCSV(
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vSaLvOcmHtlpogDiYQtvcGQD15vhTxms_YVyBK2nFs7JKBYhVVOqdyD8bEG9TfGaoB_ROitY7CnOP_h/pub?gid=1559290885&single=true&output=csv',
      'ranking-table',
      'ranking',
      true,
      20,
      true,
      2
    );
  </script>
</body>
</html>
